<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agri-Chain | Login & Signup</title>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:linear-gradient(120deg,#020617,#0b1120,#020617);
  color:white;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.box{
  background:#020617;
  width:100%;
  max-width:420px;
  padding:26px;
  border-radius:18px;
}
h1{text-align:center;color:#22c55e;margin:0}
p{text-align:center;color:#9ca3af;font-size:14px;margin:6px 0 20px}
.tabs{display:flex;justify-content:space-around;margin-bottom:18px}
.tabs span{cursor:pointer;font-weight:bold;color:#9ca3af}
.tabs .active{color:#22c55e;border-bottom:2px solid #22c55e}
input,select{
  width:100%;padding:12px;margin:8px 0;
  background:#020617;border:1px solid #334155;
  color:white;border-radius:8px
}
button{
  width:100%;padding:12px;margin-top:12px;
  background:#16a34a;border:none;border-radius:8px;
  color:white;font-weight:bold;cursor:pointer
}
button:hover{background:#22c55e}
.msg{font-size:13px;margin-top:6px;color:#f87171;text-align:center}
.hidden{display:none}
</style>
</head>

<body>

<div class="box">
  <h1>ðŸŒ¿ Agri-Chain</h1>
  <p>Smart Farm-to-Fork System</p>

  <div class="tabs">
    <span id="loginTab" class="active">Login</span>
    <span id="signupTab">Sign Up</span>
  </div>

  <!-- LOGIN -->
  <div id="loginForm">
    <input id="loginEmail" placeholder="Email">
    <input id="loginPass" type="password" placeholder="Password">
    <button type="button" id="loginBtn">Login</button>
    <div id="loginMsg" class="msg"></div>
  </div>

  <!-- SIGNUP -->
  <div id="signupForm" class="hidden">
    <input id="name" placeholder="Full Name">
    <input id="mobile" placeholder="Mobile Number (10 digits)">
    <input id="email" placeholder="Email">
    <input id="pass" type="password" placeholder="Password">

    <select id="role">
      <option value="">Select Role</option>
      <option value="farmer">Farmer</option>
      <option value="retailer">Retailer</option>
      <option value="shipping">Shipping</option>
    </select>

    <button type="button" id="signupBtn">Create Account</button>
    <div id="signupMsg" class="msg"></div>
  </div>
</div>

<!-- Firebase init -->
<script src="firebase.js"></script>

<script>
/* TAB SWITCH */
loginTab.onclick = () => {
  loginForm.classList.remove("hidden");
  signupForm.classList.add("hidden");
  loginTab.classList.add("active");
  signupTab.classList.remove("active");
};

signupTab.onclick = () => {
  signupForm.classList.remove("hidden");
  loginForm.classList.add("hidden");
  signupTab.classList.add("active");
  loginTab.classList.remove("active");
};

/* SIGNUP */
signupBtn.onclick = () => {
  signupMsg.innerText = "";

  const n = name.value.trim();
  const m = mobile.value.trim();
  const e = email.value.trim();
  const p = pass.value.trim();
  const r = role.value;

  if(!n || !m || !e || !p || !r){
    signupMsg.innerText="All fields required";
    return;
  }

  if(!/^\d{10}$/.test(m)){
    signupMsg.innerText="Mobile must be 10 digits";
    return;
  }

  auth.createUserWithEmailAndPassword(e,p)
    .then(cred=>{
      return db.collection("users").doc(cred.user.uid).set({
        name:n,
        mobile:m,
        email:e,
        role:r,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    })
    .then(()=>{
      signupMsg.style.color="#22c55e";
      signupMsg.innerText="Signup successful âœ”";
      setTimeout(()=>loginTab.click(),1200);
    })
    .catch(err=>{
      signupMsg.innerText=err.message;
    });
};

/* LOGIN */
loginBtn.onclick = async () => {
  loginMsg.innerText="";
  try{
    const cred = await auth.signInWithEmailAndPassword(
      loginEmail.value.trim(),
      loginPass.value.trim()
    );
    const doc = await db.collection("users").doc(cred.user.uid).get();
    const r = doc.data().role;

    if(r==="farmer") location.href="farmer.html";
    else if(r==="retailer") location.href="retailer.html";
    else location.href="shipped.html";

  }catch(e){
    loginMsg.innerText=e.message;
  }
};
</script>

</body>
</html>
