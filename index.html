<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agri-Chain | Login & Signup</title>

<!-- Firebase SDKs (ONLY SDKs here) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{ box-sizing:border-box; }

body{
    margin:0;
    font-family:Arial, Helvetica, sans-serif;
    background:linear-gradient(120deg,#020617,#0b1120,#020617);
    color:white;
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px 12px;
}

/* HEADER */
.welcome{
    text-align:center;
    margin-bottom:20px;
}
.welcome h1{
    color:#22c55e;
    font-size:32px;
    margin:0;
}
.welcome p{
    color:#9ca3af;
    font-size:14px;
    margin-top:6px;
}

/* CARD */
.box{
    background:#020617;
    padding:24px;
    width:100%;
    max-width:380px;
    border-radius:18px;
    box-shadow:0 0 35px rgba(0,0,0,0.7);
}

/* TABS */
.tabs{
    display:flex;
    justify-content:space-around;
    margin-bottom:20px;
}
.tabs span{
    cursor:pointer;
    padding-bottom:6px;
    font-weight:bold;
    color:#9ca3af;
    font-size:15px;
}
.tabs .active{
    color:#22c55e;
    border-bottom:2px solid #22c55e;
}

/* INPUTS */
input, select{
    width:100%;
    padding:12px;
    margin:8px 0;
    background:#020617;
    border:1px solid #334155;
    color:white;
    border-radius:8px;
    outline:none;
    font-size:14px;
}
input:focus, select:focus{
    border-color:#22c55e;
}

/* BUTTON */
button{
    width:100%;
    padding:12px;
    margin-top:12px;
    background:#16a34a;
    border:none;
    border-radius:8px;
    color:white;
    font-weight:bold;
    cursor:pointer;
    font-size:15px;
}
button:hover{
    background:#22c55e;
}

/* TEXT */
.error{
    color:#f87171;
    font-size:13px;
    margin-top:6px;
}
.success{
    color:#22c55e;
    font-size:13px;
    margin-top:6px;
}
.hidden{ display:none; }

@media(max-width:480px){
    .welcome h1{ font-size:28px; }
    .box{ padding:20px; }
}
</style>
</head>

<body>

<div class="welcome">
    <h1>ðŸŒ¿ Agri-Chain</h1>
    <p>Smart Farm-to-Fork Blockchain System</p>
</div>

<div class="box">

    <div class="tabs">
        <span id="loginTab" class="active">Login</span>
        <span id="signupTab">Sign Up</span>
    </div>

    <!-- LOGIN -->
    <div id="loginForm">
        <input id="loginEmail" placeholder="Email">
        <input id="loginPass" type="password" placeholder="Password">
        <button id="loginBtn">Login</button>
        <div id="loginMsg" class="error"></div>
    </div>

    <!-- SIGNUP -->
    <div id="signupForm" class="hidden">
        <input id="signName" placeholder="Full Name">
        <input id="signMobile" placeholder="Mobile Number">
        <input id="signEmail" placeholder="Email">
        <input id="signPass" type="password" placeholder="Password">

        <select id="signRole">
            <option value="">Select Role</option>
            <option value="farmer">Farmer</option>
            <option value="retailer">Retailer</option>
            <option value="shipping">Shipping</option>
        </select>

        <button id="signupBtn">Create Account</button>
        <div id="signupMsg" class="error"></div>
    </div>

</div>

<!-- ðŸ”¥ COMMON FIREBASE FILE -->
<script src="firebase.js"></script>

<script>
/* ---------- TAB SWITCH ---------- */
loginTab.onclick = () => {
    loginForm.classList.remove("hidden");
    signupForm.classList.add("hidden");
    loginTab.classList.add("active");
    signupTab.classList.remove("active");
};

signupTab.onclick = () => {
    signupForm.classList.remove("hidden");
    loginForm.classList.add("hidden");
    signupTab.classList.add("active");
    loginTab.classList.remove("active");
};

/* ---------- SIGNUP ---------- */
function signup(){
  signupMsg.style.color = "#f87171";
  signupMsg.innerText = "";
  signupBtn.disabled = true;

  const n = document.getElementById("name").value.trim();
  const m = document.getElementById("mobile").value.trim();
  const e = document.getElementById("email").value.trim();
  const p = document.getElementById("pass").value.trim();
  const r = document.getElementById("role").value;
  const f = document.getElementById("farmerId").value.trim();

  if(!n || !m || !e || !p || !r){
    signupBtn.disabled=false;
    signupMsg.innerText="All fields required";
    return;
  }

  if(!/^\d{10}$/.test(m)){
    signupBtn.disabled=false;
    signupMsg.innerText="Mobile must be 10 digits";
    return;
  }

  if((r==="retailer" || r==="shipping") && !f){
    signupBtn.disabled=false;
    signupMsg.innerText="Farmer ID required";
    return;
  }

  auth.createUserWithEmailAndPassword(e,p)
    .then(cred=>{
      return db.collection("users").doc(cred.user.uid).set({
        name:n,
        mobile:m,
        email:e,
        role:r,
        farmerId: r==="farmer" ? null : f,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    })
    .then(()=>{
      signupMsg.style.color="#22c55e";
      signupMsg.innerText="Signup successful âœ”";
      setTimeout(()=>loginTab.click(),1200);
    })
    .catch(err=>{
      signupMsg.innerText=err.message;
    })
    .finally(()=>{
      signupBtn.disabled=false;
    });
}


/* ---------- LOGIN ---------- */
loginBtn.onclick = async () => {
    loginMsg.innerText = "";

    try{
        const cred = await auth.signInWithEmailAndPassword(
            loginEmail.value,
            loginPass.value
        );

        const doc = await db.collection("users").doc(cred.user.uid).get();
        const role = doc.data().role;

        if(role === "farmer") location.href = "farmer.html";
        else if(role === "retailer") location.href = "retailer.html";
        else location.href = "shippment.html";

    }catch(e){
        loginMsg.innerText = e.message;
    }
};
</script>

</body>
</html>
